<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>STACK ‚Äî by bbmw0</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="STACK">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0A0A1A">
<meta name="description" content="STACK ‚Äî addictive block stacking game with 10 phases. Play free in your browser.">
<meta property="og:title" content="STACK ‚Äî by bbmw0">
<meta property="og:description" content="An addictive stacking game that transforms as you climb. 10 phases, power-ups, leaderboard.">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIj48cmVjdCB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgcng9IjQwIiBmaWxsPSIjMEEwQTFBIi8+PHJlY3QgeD0iMzAiIHk9IjExNSIgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgcng9IjQiIGZpbGw9IiNGRjZCNkIiLz48cmVjdCB4PSIzOCIgeT0iODkiIHdpZHRoPSIxMDQiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjRkY4RTUzIi8+PHJlY3QgeD0iNDYiIHk9IjYzIiB3aWR0aD0iODgiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjRkZDNTNEIi8+PHJlY3QgeD0iNTQiIHk9IjM3IiB3aWR0aD0iNzIiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjNTFDRjY2Ii8+PC9zdmc+">
<style>
*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;background:#0A0A1A;font-family:'Courier New',monospace;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
#app{width:100%;height:100dvh;position:relative;overflow:hidden;touch-action:manipulation}
canvas{display:block;width:100%;height:100%;position:absolute;top:0;left:0}
#tap{position:absolute;inset:0;z-index:5;display:none}
.nt{pointer-events:none}
.hud{position:absolute;top:env(safe-area-inset-top,16px);left:0;right:0;padding:14px 20px;display:flex;justify-content:space-between;align-items:flex-start;z-index:12;pointer-events:none}
.hsc{color:#fff;font-size:42px;font-weight:bold;line-height:1;text-shadow:0 0 20px rgba(255,107,107,0.4)}
.hbs{color:rgba(255,255,255,0.4);font-size:18px;font-weight:bold}
.hl{color:rgba(255,255,255,0.28);font-size:9px;letter-spacing:3px;text-transform:uppercase}
.hpb{pointer-events:all;cursor:pointer;width:34px;height:34px;border-radius:50%;background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,0.4);font-size:13px;font-weight:bold;margin-top:4px}
.plbl{position:absolute;top:env(safe-area-inset-top,16px);left:50%;transform:translateX(-50%);z-index:12;pointer-events:none;font-size:9px;letter-spacing:4px;text-transform:uppercase;opacity:0.45;transition:all 0.5s}
.pup{position:absolute;bottom:75px;left:50%;transform:translateX(-50%);z-index:12;pointer-events:none;padding:6px 16px;border-radius:18px;font-size:11px;font-weight:bold;letter-spacing:2px;opacity:0;transition:opacity 0.3s}.pup.on{opacity:1}
.clbl{position:absolute;top:90px;left:50%;transform:translateX(-50%);z-index:12;pointer-events:none;font-size:15px;font-weight:bold;opacity:0;transition:opacity 0.2s;text-shadow:0 0 12px currentColor}.clbl.on{opacity:1}
.ftxt{position:absolute;top:36%;left:50%;transform:translate(-50%,-50%);z-index:12;pointer-events:none;color:#fff;font-size:24px;font-weight:bold;letter-spacing:8px;text-shadow:0 0 25px rgba(255,255,255,0.5);opacity:0;transition:opacity 0.12s}.ftxt.on{opacity:0.9}
.pann{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.5);z-index:14;pointer-events:none;text-align:center;opacity:0;transition:all 0.5s cubic-bezier(0.175,0.885,0.32,1.275)}.pann.on{opacity:1;transform:translate(-50%,-50%) scale(1)}
.pann-n{font-size:34px;font-weight:bold;color:#fff;letter-spacing:5px}.pann-s{font-size:10px;letter-spacing:3px;margin-top:5px;opacity:0.35}
.ach{position:absolute;top:55px;left:50%;transform:translateX(-50%) translateY(-70px);z-index:30;background:rgba(25,25,45,0.95);border:1px solid rgba(255,197,61,0.25);border-radius:10px;padding:9px 15px;display:flex;align-items:center;gap:8px;opacity:0;transition:all 0.4s;pointer-events:none}.ach.on{transform:translateX(-50%) translateY(0);opacity:1}
/* Install banner */
.ibanner{position:absolute;bottom:0;left:0;right:0;z-index:25;background:rgba(20,20,40,0.97);border-top:1px solid rgba(255,255,255,0.08);padding:14px 20px;display:flex;align-items:center;gap:12px;transform:translateY(100%);transition:transform 0.3s}.ibanner.on{transform:translateY(0)}
.ibanner-txt{flex:1;color:rgba(255,255,255,0.7);font-size:11px;line-height:1.4}.ibanner-txt b{color:#fff}
.ibanner-x{color:rgba(255,255,255,0.3);font-size:18px;cursor:pointer;padding:4px 8px}
/* Online indicator */
.online-dot{position:absolute;top:env(safe-area-inset-top,16px);left:50%;margin-left:50px;z-index:12;width:7px;height:7px;border-radius:50%;pointer-events:none;transition:background 0.3s}
.online-dot.on{background:#51CF66;box-shadow:0 0 6px rgba(81,207,102,0.5)}.online-dot.off{background:#FF6B6B;box-shadow:0 0 6px rgba(255,107,107,0.4)}
/* Overlays */
.ov{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;background:rgba(10,10,26,0.95);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);transition:opacity 0.3s}.ov.hide{opacity:0;pointer-events:none}
.st{font-size:56px;font-weight:bold;color:#fff;letter-spacing:10px;text-shadow:0 0 50px rgba(255,107,107,0.4);margin-bottom:4px}
.ss{color:rgba(255,255,255,0.22);font-size:11px;letter-spacing:6px;margin-bottom:5px}
.sv{color:rgba(255,255,255,0.1);font-size:9px;letter-spacing:2px;margin-bottom:32px}
.sc{width:68px;height:68px;border-radius:50%;border:2px solid rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;animation:br 2s infinite ease-in-out;cursor:pointer}
.sd{width:14px;height:14px;border-radius:50%;background:#FF6B6B;box-shadow:0 0 18px rgba(255,107,107,0.4)}
.slbl{color:rgba(255,255,255,0.16);font-size:10px;letter-spacing:3px;margin-top:16px}
.sby{color:rgba(255,255,255,0.13);font-size:10px;letter-spacing:2px;margin-top:24px}
.snav{position:absolute;bottom:env(safe-area-inset-bottom,28px);display:flex;gap:8px;flex-wrap:wrap;justify-content:center;padding:0 12px 8px}
.sb{color:rgba(255,255,255,0.25);font-size:9px;letter-spacing:1.5px;cursor:pointer;padding:7px 12px;border:1px solid rgba(255,255,255,0.06);border-radius:18px;font-family:inherit;background:none}
.sb:active{background:rgba(255,255,255,0.04)}
.sb.ac{border-color:rgba(255,107,107,0.15);color:rgba(255,107,107,0.5);background:rgba(255,107,107,0.04)}
.sb.gd{border-color:rgba(255,197,61,0.15);color:rgba(255,197,61,0.5);background:rgba(255,197,61,0.04)}
/* Game Over */
.gl{color:rgba(255,255,255,0.28);font-size:11px;letter-spacing:5px;text-transform:uppercase;margin-bottom:8px}
.gsc{font-size:72px;font-weight:bold;color:#fff;line-height:1;text-shadow:0 0 25px rgba(255,107,107,0.35)}
.gnw{color:#FFC53D;font-size:12px;letter-spacing:3px;margin-top:5px}.gnw.hide{display:none}
.gbs{color:rgba(255,255,255,0.22);font-size:12px;margin-top:5px}
.gph{color:rgba(255,255,255,0.16);font-size:9px;letter-spacing:2px;margin:5px 0}
.gr{display:flex;gap:28px;margin:10px 0}
.gsl{color:rgba(255,255,255,0.22);font-size:9px;letter-spacing:2px;text-transform:uppercase;text-align:center}
.gsv{color:rgba(255,255,255,0.6);font-size:18px;font-weight:bold;text-align:center;margin-top:2px}
.gxp{color:rgba(255,255,255,0.18);font-size:10px;margin-bottom:14px}.gxp span{color:#51CF66}
.gbt{display:flex;gap:10px}
.gb{padding:12px 26px;border:1px solid rgba(255,255,255,0.08);border-radius:24px;color:rgba(255,255,255,0.4);font-size:10px;letter-spacing:3px;text-transform:uppercase;font-family:inherit;cursor:pointer;background:none}
.gb:active{background:rgba(255,255,255,0.04)}.gb.pr{border-color:rgba(255,107,107,0.2);color:rgba(255,107,107,0.7)}
.gsh{margin-top:8px;padding:8px 20px;border:1px solid rgba(255,255,255,0.04);border-radius:18px;color:rgba(255,255,255,0.18);font-size:9px;letter-spacing:2px;cursor:pointer;background:none;font-family:inherit}
/* Scrollable screens */
.scr{overflow-y:auto;padding:50px 20px 40px;align-items:stretch;justify-content:flex-start;-webkit-overflow-scrolling:touch}
.cls{position:absolute;top:env(safe-area-inset-top,14px);right:14px;width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.05);border:none;color:rgba(255,255,255,0.3);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:inherit;z-index:2}
.sec{color:rgba(255,255,255,0.22);font-size:9px;letter-spacing:3px;text-transform:uppercase;margin:18px 0 8px}
.sg{display:grid;grid-template-columns:1fr 1fr;gap:7px}
.scd{background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.04);border-radius:9px;padding:10px;text-align:center}
.scv{color:#fff;font-size:20px;font-weight:bold}.scl{color:rgba(255,255,255,0.22);font-size:8px;letter-spacing:2px;text-transform:uppercase;margin-top:2px}
.ag{display:flex;flex-direction:column;gap:5px}
.ar{display:flex;align-items:center;gap:9px;padding:9px 11px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);border-radius:8px}.ar.lk{opacity:0.25}
.ll{display:flex;flex-direction:column;gap:4px}
.lr{display:flex;align-items:center;gap:9px;padding:8px 11px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);border-radius:8px}.lr.you{border-color:rgba(255,107,107,0.12);background:rgba(255,107,107,0.03)}
.gs{display:flex;gap:7px;margin-bottom:8px}
.gi{flex:1;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);border-radius:8px;padding:8px 11px;color:#fff;font-family:inherit;font-size:12px;outline:none}.gi::placeholder{color:rgba(255,255,255,0.15)}
.gsb{background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.15);border-radius:8px;padding:8px 12px;color:#FF6B6B;font-family:inherit;font-size:11px;font-weight:bold;cursor:pointer}
.nm-status{color:rgba(255,255,255,0.25);font-size:9px;margin-bottom:10px;min-height:14px}
.lbn{display:flex;align-items:center;justify-content:center;gap:7px;padding:11px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.07);font-family:inherit;font-size:11px;font-weight:bold;cursor:pointer;opacity:0.5}
.lbn.gg{background:rgba(255,255,255,0.92);color:#333}.lbn.ap{background:#000;color:#fff;border-color:rgba(255,255,255,0.12)}.lbn.li{background:#0A66C2;color:#fff;border-color:transparent}
.pb{display:flex;flex-wrap:wrap;gap:7px;margin-top:8px}
.pbtn{flex:1;min-width:45%;padding:10px;border:1px solid rgba(255,255,255,0.05);border-radius:9px;background:rgba(255,255,255,0.02);color:rgba(255,255,255,0.35);font-size:9px;letter-spacing:1px;text-align:center;cursor:pointer;font-family:inherit}
.pbtn:active{background:rgba(255,255,255,0.05)}
.rst{margin-top:16px;padding:8px 16px;border:1px solid rgba(255,60,60,0.1);border-radius:8px;background:none;color:rgba(255,60,60,0.3);font-size:8px;letter-spacing:2px;cursor:pointer;font-family:inherit;text-transform:uppercase;align-self:center}
/* Lang selector */
.lang-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.lang-opt{padding:9px 10px;border:1px solid rgba(255,255,255,0.05);border-radius:8px;background:rgba(255,255,255,0.02);color:rgba(255,255,255,0.5);font-size:10px;text-align:center;cursor:pointer;font-family:inherit}
.lang-opt:active,.lang-opt.sel{border-color:rgba(255,107,107,0.2);color:#FF6B6B;background:rgba(255,107,107,0.04)}
/* Guide */
.gd-t{color:#fff;font-size:20px;font-weight:bold;letter-spacing:3px;text-align:center;margin-bottom:4px}
.gd-s{color:rgba(255,255,255,0.18);font-size:9px;letter-spacing:3px;text-align:center;margin-bottom:20px}
.gd-c{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);border-radius:10px;padding:12px 14px;margin-bottom:8px;display:flex;gap:10px}
.gd-n{font-size:20px;font-weight:bold;min-width:28px}.gd-nm{color:#fff;font-size:12px;font-weight:bold}.gd-r{color:rgba(255,255,255,0.18);font-size:8px;margin-top:1px}.gd-d{color:rgba(255,255,255,0.3);font-size:9px;line-height:1.5;margin-top:4px}
.gd-m{display:inline-block;padding:2px 7px;border-radius:8px;font-size:8px;font-weight:bold;letter-spacing:1px;margin-top:3px}
@keyframes br{0%,100%{transform:scale(1);opacity:0.5}50%{transform:scale(1.1);opacity:1}}
</style>
</head>
<body>
<div id="app">
<canvas id="c"></canvas>
<div id="tap"></div>
<div class="hud nt" id="hud" style="display:none">
  <div><div class="hl" data-t="score">Score</div><div class="hsc" id="dSc">0</div></div>
  <div style="display:flex;flex-direction:column;align-items:flex-end;gap:5px">
    <div><div class="hl" style="text-align:right" data-t="best">Best</div><div class="hbs" id="dBs">0</div></div>
    <div class="hpb" id="bPr" style="pointer-events:all">?</div>
  </div>
</div>
<div class="online-dot" id="oD"></div>
<div class="plbl nt" id="dPh"></div>
<div class="pup nt" id="dPu"></div>
<div class="clbl nt" id="dCo"></div>
<div class="ftxt nt" id="dFl">PERFECT</div>
<div class="pann nt" id="dPA"><div class="pann-n" id="dPAN"></div><div class="pann-s" id="dPAS"></div></div>
<div class="ach nt" id="dAc"><div id="dAcI" style="font-size:18px">üèÜ</div><div><div style="color:rgba(255,197,61,0.45);font-size:8px;letter-spacing:2px" data-t="achievement">ACHIEVEMENT</div><div id="dAcN" style="color:#fff;font-size:11px;font-weight:bold;margin-top:1px">‚Äî</div></div></div>
<!-- Install banner -->
<div class="ibanner" id="iBan">
  <div style="font-size:24px">üì≤</div>
  <div class="ibanner-txt"><b data-t="installTitle">Install STACK</b><br><span data-t="installDesc">Add to home screen for offline play</span></div>
  <div class="ibanner-x" id="iBanX">‚úï</div>
</div>
<!-- START -->
<div class="ov" id="ovS">
  <div class="st">STACK</div>
  <div class="ss" data-t="tapToDrop">TAP TO DROP</div>
  <div class="sv">v3.0 ‚Äî 10 phases</div>
  <div class="sc" id="startC"><div class="sd"></div></div>
  <div class="slbl" data-t="tapAnywhere">TAP ANYWHERE</div>
  <div class="sby">created by bbmw0</div>
  <div class="snav">
    <button class="sb" id="bNP" data-t="profile">PROFILE</button>
    <button class="sb" id="bNG" data-t="guide">GUIDE</button>
    <button class="sb ac" id="bSL">‚Üó <span data-t="share">SHARE</span></button>
    <button class="sb gd" id="bCof">‚òï <span data-t="support">SUPPORT</span></button>
    <button class="sb" id="bLng">üåê <span data-t="language">LANG</span></button>
  </div>
</div>
<!-- GAME OVER -->
<div class="ov hide" id="ovG">
  <div class="gl" data-t="gameOver">Game Over</div>
  <div class="gsc" id="gSc">0</div>
  <div class="gnw hide" id="gNw" data-t="newBest">‚òÖ NEW BEST ‚òÖ</div>
  <div class="gbs" id="gBs">Best: 0</div>
  <div class="gph" id="gPh"></div>
  <div class="gr">
    <div><div class="gsl" data-t="combo">Combo</div><div class="gsv" id="gCo">0</div></div>
    <div><div class="gsl" data-t="perfects">Perfects</div><div class="gsv" id="gPf">0</div></div>
    <div><div class="gsl" data-t="games">Games</div><div class="gsv" id="gGp">0</div></div>
  </div>
  <div class="gxp" id="gXp">+<span>0</span> XP</div>
  <div class="gbt"><button class="gb pr" id="bRe" data-t="retry">RETRY</button><button class="gb" id="bHo" data-t="home">HOME</button></div>
  <button class="gsh" id="bSS" data-t="shareScore">SHARE SCORE</button>
</div>
<!-- GUIDE -->
<div class="ov hide scr" id="ovGd">
  <button class="cls" id="bGdX">‚úï</button>
  <div class="gd-t" data-t="phaseGuide">PHASE GUIDE</div>
  <div class="gd-s" data-t="gameTransforms">THE GAME TRANSFORMS AS YOU CLIMB</div>
  <div id="gdL"></div>
  <div class="sec" data-t="powerUps">POWER-UPS</div>
  <div id="gdP"></div>
  <div class="sec" data-t="tips">TIPS</div>
  <div id="gdTips" style="color:rgba(255,255,255,0.3);font-size:10px;line-height:1.7;text-align:center;padding:0 10px"></div>
</div>
<!-- LANGUAGE -->
<div class="ov hide scr" id="ovLn">
  <button class="cls" id="bLnX">‚úï</button>
  <div class="gd-t" data-t="selectLang">SELECT LANGUAGE</div>
  <div class="gd-s">üåê</div>
  <div class="lang-grid" id="lnG"></div>
  <div style="color:rgba(255,255,255,0.12);font-size:8px;text-align:center;margin-top:16px;line-height:1.6" id="lnNote"></div>
</div>
<!-- PROFILE -->
<div class="ov hide scr" id="ovPr">
  <button class="cls" id="bPrX">‚úï</button>
  <div style="text-align:center;margin-bottom:20px"><div style="width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#FF6B6B,#845EF7);display:flex;align-items:center;justify-content:center;margin:0 auto 8px;font-size:24px;font-weight:bold;color:#fff" id="pAv">?</div><div style="color:#fff;font-size:16px;font-weight:bold;letter-spacing:2px" id="pNm">Guest</div><div style="color:rgba(255,255,255,0.28);font-size:10px;letter-spacing:2px;margin-top:3px" id="pLv">Level 1</div><div style="width:160px;height:3px;background:rgba(255,255,255,0.06);border-radius:2px;margin:6px auto 0;overflow:hidden"><div style="height:100%;background:linear-gradient(90deg,#51CF66,#339AF0);border-radius:2px;transition:width 0.4s" id="pXp"></div></div></div>
  <div class="sec" data-t="playerName">Player Name</div>
  <div class="gs"><input type="text" class="gi" id="pNI" placeholder="" maxlength="16"><button class="gsb" id="bNS" data-t="save">SAVE</button></div>
  <div class="nm-status" id="nmSt"></div>
  <div class="sec" data-t="statistics">Statistics</div>
  <div class="sg"><div class="scd"><div class="scv" id="s1">0</div><div class="scl" data-t="bestScore">Best</div></div><div class="scd"><div class="scv" id="s2">0</div><div class="scl" data-t="games">Games</div></div><div class="scd"><div class="scv" id="s3">0</div><div class="scl" data-t="perfects">Perfects</div></div><div class="scd"><div class="scv" id="s4">0</div><div class="scl" data-t="combo">Combo</div></div><div class="scd"><div class="scv" id="s5">0</div><div class="scl" data-t="avg">Avg</div></div><div class="scd"><div class="scv" id="s6">0</div><div class="scl">XP</div></div></div>
  <div class="sec" data-t="achievements">Achievements</div>
  <div class="ag" id="aG"></div>
  <div class="sec" data-t="leaderboard">Leaderboard</div>
  <div class="ll" id="lL"></div>
  <div id="lbSync" style="color:rgba(255,255,255,0.15);font-size:8px;text-align:center;margin-top:6px"></div>
  <div class="sec">Quick Links</div>
  <div class="pb">
    <button class="pbtn" id="pShr">‚Üó <span data-t="share">SHARE</span></button>
    <button class="pbtn" id="pGd" data-t="guide">GUIDE</button>
    <button class="pbtn" id="pCof">‚òï <span data-t="support">SUPPORT</span></button>
    <button class="pbtn" id="pLng">üåê <span data-t="language">LANG</span></button>
    <button class="pbtn" id="pSync" data-t="syncNow">SYNC NOW</button>
  </div>
  <div class="sec" data-t="signIn">Sign In</div>
  <div style="color:rgba(255,255,255,0.15);font-size:9px;text-align:center;margin-bottom:8px" data-t="comingSoon">Coming soon ‚Äî in development</div>
  <div style="display:flex;flex-direction:column;gap:7px">
    <button class="lbn gg" id="bG">Google ‚Äî <span data-t="comingSoon">Coming soon</span></button>
    <button class="lbn ap" id="bA">Apple ‚Äî <span data-t="comingSoon">Coming soon</span></button>
    <button class="lbn li" id="bL">LinkedIn ‚Äî <span data-t="comingSoon">Coming soon</span></button>
  </div>
  <button class="rst" id="bRst" data-t="resetAll">RESET ALL DATA</button>
</div>
</div>
<script>
if('serviceWorker' in navigator)navigator.serviceWorker.register('/sw.js').catch(()=>{});
</script>
<script>
(function(){
"use strict";
const $=id=>document.getElementById(id);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LANGS={
en:{name:"English",score:"Score",best:"Best",perfect:"PERFECT",tapToDrop:"TAP TO DROP",tapAnywhere:"TAP ANYWHERE",profile:"PROFILE",guide:"GUIDE",share:"SHARE",support:"SUPPORT",language:"LANG",gameOver:"Game Over",newBest:"‚òÖ NEW BEST ‚òÖ",combo:"Combo",perfects:"Perfects",games:"Games",retry:"RETRY",home:"HOME",shareScore:"SHARE SCORE",playerName:"Player Name",save:"SAVE",statistics:"Statistics",bestScore:"Best",avg:"Avg",achievements:"Achievements",leaderboard:"Leaderboard",signIn:"Sign In",comingSoon:"Coming soon",resetAll:"RESET ALL DATA",phaseGuide:"PHASE GUIDE",gameTransforms:"THE GAME TRANSFORMS AS YOU CLIMB",powerUps:"POWER-UPS",tips:"TIPS",installTitle:"Install STACK",installDesc:"Add to home screen for offline play",selectLang:"SELECT LANGUAGE",syncNow:"SYNC NOW",reached:"Reached",achievement:"ACHIEVEMENT",nameTaken:"Name already taken",nameOk:"Name available ‚úì",enterName:"Enter name..."},
es:{name:"Espa√±ol",score:"Puntos",best:"Mejor",perfect:"PERFECTO",tapToDrop:"TOCA PARA SOLTAR",tapAnywhere:"TOCA DONDE SEA",profile:"PERFIL",guide:"GU√çA",share:"COMPARTIR",support:"APOYAR",language:"IDIOMA",gameOver:"Fin del Juego",newBest:"‚òÖ NUEVO R√âCORD ‚òÖ",combo:"Combo",perfects:"Perfectos",games:"Partidas",retry:"REINTENTAR",home:"INICIO",shareScore:"COMPARTIR PUNTOS",playerName:"Nombre",save:"GUARDAR",statistics:"Estad√≠sticas",bestScore:"Mejor",avg:"Media",achievements:"Logros",leaderboard:"Clasificaci√≥n",signIn:"Iniciar sesi√≥n",comingSoon:"Pr√≥ximamente",resetAll:"BORRAR DATOS",phaseGuide:"GU√çA DE FASES",gameTransforms:"EL JUEGO CAMBIA MIENTRAS SUBES",powerUps:"POTENCIADORES",tips:"CONSEJOS",installTitle:"Instalar STACK",installDesc:"A√±adir a inicio para jugar sin conexi√≥n",selectLang:"ELEGIR IDIOMA",syncNow:"SINCRONIZAR",reached:"Alcanzado",achievement:"LOGRO",nameTaken:"Nombre en uso",nameOk:"Nombre disponible ‚úì",enterName:"Escribe tu nombre..."},
ms:{name:"Bahasa Melayu",score:"Skor",best:"Terbaik",perfect:"SEMPURNA",tapToDrop:"KETUK UNTUK JATUH",tapAnywhere:"KETUK DI MANA-MANA",profile:"PROFIL",guide:"PANDUAN",share:"KONGSI",support:"SOKONGAN",language:"BAHASA",gameOver:"Permainan Tamat",newBest:"‚òÖ REKOD BARU ‚òÖ",combo:"Kombo",perfects:"Sempurna",games:"Permainan",retry:"CUBA LAGI",home:"UTAMA",shareScore:"KONGSI SKOR",playerName:"Nama Pemain",save:"SIMPAN",statistics:"Statistik",bestScore:"Terbaik",avg:"Purata",achievements:"Pencapaian",leaderboard:"Kedudukan",signIn:"Log Masuk",comingSoon:"Akan datang",resetAll:"SET SEMULA",phaseGuide:"PANDUAN FASA",gameTransforms:"PERMAINAN BERUBAH SEMASA ANDA NAIK",powerUps:"KUASA",tips:"PETUA",installTitle:"Pasang STACK",installDesc:"Tambah ke skrin utama untuk bermain luar talian",selectLang:"PILIH BAHASA",syncNow:"SEGERAK",reached:"Dicapai",achievement:"PENCAPAIAN",nameTaken:"Nama telah digunakan",nameOk:"Nama tersedia ‚úì",enterName:"Masukkan nama..."},
ja:{name:"Êó•Êú¨Ë™û",score:"„Çπ„Ç≥„Ç¢",best:"„Éô„Çπ„Éà",perfect:"„Éë„Éº„Éï„Çß„ÇØ„Éà",tapToDrop:"„Çø„ÉÉ„Éó„ÅßËêΩ„Å®„Åô",tapAnywhere:"„Å©„Åì„Åß„ÇÇ„Çø„ÉÉ„Éó",profile:"„Éó„É≠„Éï„Ç£„Éº„É´",guide:"„Ç¨„Ç§„Éâ",share:"„Ç∑„Çß„Ç¢",support:"„Çµ„Éù„Éº„Éà",language:"Ë®ÄË™û",gameOver:"„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº",newBest:"‚òÖ Êñ∞Ë®òÈå≤ ‚òÖ",combo:"„Ç≥„É≥„Éú",perfects:"„Éë„Éº„Éï„Çß„ÇØ„Éà",games:"„Ç≤„Éº„É†Êï∞",retry:"„É™„Éà„É©„Ç§",home:"„Éõ„Éº„É†",shareScore:"„Çπ„Ç≥„Ç¢„ÇíÂÖ±Êúâ",playerName:"„Éó„É¨„Ç§„É§„ÉºÂêç",save:"‰øùÂ≠ò",statistics:"Áµ±Ë®à",bestScore:"„Éô„Çπ„Éà",avg:"Âπ≥Âùá",achievements:"ÂÆüÁ∏æ",leaderboard:"„É©„É≥„Ç≠„É≥„Ç∞",signIn:"„É≠„Ç∞„Ç§„É≥",comingSoon:"ËøëÊó•ÂÖ¨Èñã",resetAll:"„Éá„Éº„Çø„É™„Çª„ÉÉ„Éà",phaseGuide:"„Éï„Çß„Éº„Ç∫„Ç¨„Ç§„Éâ",gameTransforms:"Áôª„Çã„Åª„Å©„Ç≤„Éº„É†„ÅåÂ§âÂåñ„Åô„Çã",powerUps:"„Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó",tips:"„Éí„É≥„Éà",installTitle:"STACK„Çí„Ç§„É≥„Çπ„Éà„Éº„É´",installDesc:"„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Åó„Å¶„Ç™„Éï„É©„Ç§„É≥„Éó„É¨„Ç§",selectLang:"Ë®ÄË™û„ÇíÈÅ∏Êäû",syncNow:"ÂêåÊúü",reached:"Âà∞ÈÅî",achievement:"ÂÆüÁ∏æËß£Èô§",nameTaken:"„Åì„ÅÆÂêçÂâç„ÅØ‰ΩøÁî®‰∏≠„Åß„Åô",nameOk:"‰ΩøÁî®ÂèØËÉΩ ‚úì",enterName:"ÂêçÂâç„ÇíÂÖ•Âäõ..."},
ar:{name:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",score:"ÿßŸÑŸÜŸÇÿßÿ∑",best:"ÿßŸÑÿ£ŸÅÿ∂ŸÑ",perfect:"ŸÖŸÖÿ™ÿßÿ≤",tapToDrop:"ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿ•ÿ≥ŸÇÿßÿ∑",tapAnywhere:"ÿßÿ∂ÿ∫ÿ∑ ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜ",profile:"ÿßŸÑŸÖŸÑŸÅ",guide:"ÿßŸÑÿØŸÑŸäŸÑ",share:"ŸÖÿ¥ÿßÿ±ŸÉÿ©",support:"ÿØÿπŸÖ",language:"ÿßŸÑŸÑÿ∫ÿ©",gameOver:"ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©",newBest:"‚òÖ ÿ±ŸÇŸÖ ŸÇŸäÿßÿ≥Ÿä ‚òÖ",combo:"ŸÉŸàŸÖÿ®Ÿà",perfects:"ŸÖŸÖÿ™ÿßÿ≤",games:"ÿ£ŸÑÿπÿßÿ®",retry:"ÿ•ÿπÿßÿØÿ©",home:"ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",shareScore:"ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",playerName:"ÿßŸÑÿßÿ≥ŸÖ",save:"ÿ≠ŸÅÿ∏",statistics:"ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™",bestScore:"ÿßŸÑÿ£ŸÅÿ∂ŸÑ",avg:"ÿßŸÑŸÖÿπÿØŸÑ",achievements:"ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™",leaderboard:"ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ",signIn:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",comingSoon:"ŸÇÿ±Ÿäÿ®ÿßŸã",resetAll:"ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",phaseGuide:"ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ",gameTransforms:"ÿßŸÑŸÑÿπÿ®ÿ© ÿ™ÿ™ÿ∫Ÿäÿ± ŸÉŸÑŸÖÿß ÿµÿπÿØÿ™",powerUps:"ÿßŸÑÿ™ÿπÿ≤Ÿäÿ≤ÿßÿ™",tips:"ŸÜÿµÿßÿ¶ÿ≠",installTitle:"ÿ™ÿ´ÿ®Ÿäÿ™ STACK",installDesc:"ÿ£ÿ∂ŸÅ ŸÑŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑŸÑÿπÿ® ÿ®ÿØŸàŸÜ ÿßÿ™ÿµÿßŸÑ",selectLang:"ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©",syncNow:"ŸÖÿ≤ÿßŸÖŸÜÿ©",reached:"ŸàÿµŸÑÿ™ ÿ•ŸÑŸâ",achievement:"ÿ•ŸÜÿ¨ÿßÿ≤",nameTaken:"ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ≥ÿ™ÿÆÿØŸÖ",nameOk:"ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ™ÿßÿ≠ ‚úì",enterName:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ..."},
"zh-CN":{name:"‰∏≠ÊñáÁÆÄ‰Ωì",score:"ÂæóÂàÜ",best:"ÊúÄ‰Ω≥",perfect:"ÂÆåÁæé",tapToDrop:"ÁÇπÂáªÊîæ‰∏ã",tapAnywhere:"ÁÇπÂáª‰ªªÊÑè‰ΩçÁΩÆ",profile:"‰∏™‰∫∫ËµÑÊñô",guide:"ÊåáÂçó",share:"ÂàÜ‰∫´",support:"ÊîØÊåÅ",language:"ËØ≠Ë®Ä",gameOver:"Ê∏∏ÊàèÁªìÊùü",newBest:"‚òÖ Êñ∞Á∫™ÂΩï ‚òÖ",combo:"ËøûÂáª",perfects:"ÂÆåÁæéÊ¨°Êï∞",games:"Ê∏∏ÊàèÊï∞",retry:"ÈáçËØï",home:"‰∏ªÈ°µ",shareScore:"ÂàÜ‰∫´ÊàêÁª©",playerName:"Áé©ÂÆ∂Âêç",save:"‰øùÂ≠ò",statistics:"ÁªüËÆ°",bestScore:"ÊúÄ‰Ω≥",avg:"Âπ≥Âùá",achievements:"ÊàêÂ∞±",leaderboard:"ÊéíË°åÊ¶ú",signIn:"ÁôªÂΩï",comingSoon:"Âç≥Â∞ÜÊé®Âá∫",resetAll:"ÈáçÁΩÆÊï∞ÊçÆ",phaseGuide:"Èò∂ÊÆµÊåáÂçó",gameTransforms:"Ê∏∏ÊàèÈöèÊîÄÂçáËÄåÂèòÂåñ",powerUps:"ÈÅìÂÖ∑",tips:"ÊèêÁ§∫",installTitle:"ÂÆâË£Ö STACK",installDesc:"Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï‰ª•Á¶ªÁ∫øÊ∏∏Êàè",selectLang:"ÈÄâÊã©ËØ≠Ë®Ä",syncNow:"ÂêåÊ≠•",reached:"Âà∞Ëææ",achievement:"ÊàêÂ∞±Ëß£ÈîÅ",nameTaken:"ÂêçÁß∞Â∑≤Ë¢´‰ΩøÁî®",nameOk:"ÂêçÁß∞ÂèØÁî® ‚úì",enterName:"ËæìÂÖ•ÂêçÁß∞..."},
"zh-HK":{name:"Á≤µË™ûÁπÅÈ´î",score:"ÂæóÂàÜ",best:"ÊúÄ‰Ω≥",perfect:"ÂÆåÁæé",tapToDrop:"Êí≥ÂöüÊîæ‰Ωé",tapAnywhere:"Êí≥‰ªª‰ΩïÂú∞Êñπ",profile:"ÂÄã‰∫∫Ë≥áÊñô",guide:"ÊåáÂçó",share:"ÂàÜ‰∫´",support:"ÊîØÊåÅ",language:"Ë™ûË®Ä",gameOver:"ÈÅäÊà≤ÁµêÊùü",newBest:"‚òÖ Êñ∞Á¥ÄÈåÑ ‚òÖ",combo:"ÈÄ£Êìä",perfects:"ÂÆåÁæéÊ¨°Êï∏",games:"ÈÅäÊà≤Êï∏",retry:"ÈáçË©¶",home:"‰∏ªÈ†Å",shareScore:"ÂàÜ‰∫´ÊàêÁ∏æ",playerName:"Áé©ÂÆ∂Âêç",save:"ÂÑ≤Â≠ò",statistics:"Áµ±Ë®à",bestScore:"ÊúÄ‰Ω≥",avg:"Âπ≥Âùá",achievements:"ÊàêÂ∞±",leaderboard:"ÊéíË°åÊ¶ú",signIn:"ÁôªÂÖ•",comingSoon:"Âç≥Â∞áÊé®Âá∫",resetAll:"ÈáçË®≠Ë≥áÊñô",phaseGuide:"ÈöéÊÆµÊåáÂçó",gameTransforms:"ÈÅäÊà≤Èö®ÊîÄÂçáËÄåËÆäÂåñ",powerUps:"ÈÅìÂÖ∑",tips:"ÊèêÁ§∫",installTitle:"ÂÆâË£ù STACK",installDesc:"Âä†ÂÖ•‰∏ªÁï´Èù¢Èõ¢Á∑öÈÅäÁé©",selectLang:"ÈÅ∏ÊìáË™ûË®Ä",syncNow:"ÂêåÊ≠•",reached:"Âà∞ÈÅî",achievement:"ÊàêÂ∞±Ëß£Èéñ",nameTaken:"ÂêçÁ®±Â∑≤Ë¢´‰ΩøÁî®",nameOk:"ÂêçÁ®±ÂèØÁî® ‚úì",enterName:"Ëº∏ÂÖ•ÂêçÁ®±..."},
ta:{name:"‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç",score:"‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡ØÜ‡Æ£‡Øç",best:"‡Æö‡Æø‡Æ±‡Æ®‡Øç‡Æ§",perfect:"‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ©",tapToDrop:"‡Æµ‡Æø‡Æü ‡Æ§‡Æü‡Øç‡Æü‡ØÅ",tapAnywhere:"‡Æé‡Æô‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æü‡Øç‡Æü‡ØÅ",profile:"‡Æö‡ØÅ‡ÆØ‡Æµ‡Æø‡Æµ‡Æ∞‡ÆÆ‡Øç",guide:"‡Æµ‡Æ¥‡Æø‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æø",share:"‡Æ™‡Æï‡Æø‡Æ∞‡Øç",support:"‡ÆÜ‡Æ§‡Æ∞‡Æµ‡ØÅ",language:"‡ÆÆ‡Øä‡Æ¥‡Æø",gameOver:"‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ",newBest:"‚òÖ ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Ææ‡Æ§‡Æ©‡Øà ‚òÖ",combo:"‡Æï‡Øä‡ÆÆ‡Øç‡Æ™‡Øã",perfects:"‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ©",games:"‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ",retry:"‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç",home:"‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ",shareScore:"‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡ØÜ‡Æ£‡Øç ‡Æ™‡Æï‡Æø‡Æ∞‡Øç",playerName:"‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç",save:"‡Æö‡Øá‡ÆÆ‡Æø",statistics:"‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡ÆÆ‡Øç",bestScore:"‡Æö‡Æø‡Æ±‡Æ®‡Øç‡Æ§",avg:"‡Æö‡Æ∞‡Ææ‡Æö‡Æ∞‡Æø",achievements:"‡Æö‡Ææ‡Æ§‡Æ©‡Øà‡Æï‡Æ≥‡Øç",leaderboard:"‡Æ§‡Æ∞‡Æµ‡Æ∞‡Æø‡Æö‡Øà",signIn:"‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà",comingSoon:"‡Æµ‡Æø‡Æ∞‡Øà‡Æµ‡Æø‡Æ≤‡Øç",resetAll:"‡Æ§‡Æ∞‡Æµ‡ØÅ ‡ÆÖ‡Æ¥‡Æø",phaseGuide:"‡Æ®‡Æø‡Æ≤‡Øà ‡Æµ‡Æ¥‡Æø‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æø",gameTransforms:"‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æè‡Æ±‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡ØÅ ‡ÆÆ‡Ææ‡Æ±‡ØÅ‡ÆÆ‡Øç",powerUps:"‡Æö‡Æï‡Øç‡Æ§‡Æø‡Æï‡Æ≥‡Øç",tips:"‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",installTitle:"STACK ‡Æ®‡Æø‡Æ±‡ØÅ‡Æµ‡ØÅ",installDesc:"‡ÆÜ‡ÆÉ‡Æ™‡Øç‡Æ≤‡Øà‡Æ©‡Æø‡Æ≤‡Øç ‡Æµ‡Æø‡Æ≥‡Øà‡ÆØ‡Ææ‡Æü ‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡Æ∞‡Øç",selectLang:"‡ÆÆ‡Øä‡Æ¥‡Æø ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ",syncNow:"‡Æí‡Æ§‡Øç‡Æ§‡Æø‡Æö‡Øà",reached:"‡ÆÖ‡Æü‡Øà‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ",achievement:"‡Æö‡Ææ‡Æ§‡Æ©‡Øà",nameTaken:"‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç ‡Æè‡Æ±‡Øç‡Æï‡Æ©‡Æµ‡Øá ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ",nameOk:"‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‚úì",enterName:"‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡ØÅ..."}
};
let CL="en";
function setLang(l){CL=l;D.lang=l;sv(D);document.querySelectorAll("[data-t]").forEach(el=>{const k=el.getAttribute("data-t");if(LANGS[l]&&LANGS[l][k])el.textContent=LANGS[l][k]});$("pNI").placeholder=T("enterName");buildGuide();bldLangGrid();$("lnNote").textContent=l==="zh-CN"?"ÁÆÄ‰Ωì‰∏≠ÊñáÈÄÇÁî®‰∫éÊôÆÈÄöËØù„ÄÅÈóΩËØ≠„ÄÅÂê¥ËØ≠„ÄÅÂÆ¢ÂÆ∂ËØù„ÄÅËµ£ËØ≠„ÄÅÊπòËØ≠":l==="zh-HK"?"Á≤µË™ûÁπÅÈ´îÂ≠ó":""}
function T(k){return(LANGS[CL]&&LANGS[CL][k])||LANGS.en[k]||k}

// ‚ïê‚ïê‚ïê CONSTANTS ‚ïê‚ïê‚ïê
const BH=28,BW=110,SI=2.0,SINC=0.09,SMAX=12,PT=5,GR=0.55;
const PH=[
  {id:"classic",n:"CLASSIC",s:"Learn the basics",from:0,to:7,bg1:"#0A0A1A",bg2:"#151528",c:["#FF6B6B","#FF8E53","#FFC53D","#51CF66","#339AF0","#845EF7"],st:0,sm:1,gl:8},
  {id:"neon",n:"NEON RUSH",s:"Blocks leave glowing trails",from:8,to:14,bg1:"#0D0025",bg2:"#1A003A",c:["#00F5FF","#00FF87","#FF00E5","#FFE500","#FF6B6B","#7B61FF"],st:10,sm:1.08,gl:18,trail:true},
  {id:"pulse",n:"PULSE",s:"Speed pulses up and down",from:15,to:21,bg1:"#1A0505",bg2:"#2D0A0A",c:["#FF6B6B","#FF8787","#FFA8A8","#FFC9C9","#FFE3E3","#FFF5F5"],st:15,sm:1,gl:12,pulse:true},
  {id:"narrow",n:"THE SQUEEZE",s:"Blocks start shrinking",from:22,to:29,bg1:"#0A1A0A",bg2:"#0A2D0A",c:["#51CF66","#69DB7C","#8CE99A","#B2F2BB","#D3F9D8","#20C997"],st:22,sm:1.1,gl:10,shrink:0.92},
  {id:"mirror",n:"MIRROR",s:"Direction flips mid-slide",from:30,to:37,bg1:"#1A1A00",bg2:"#2D2D00",c:["#FFC53D","#FFD43B","#FFE066","#FFEC99","#FFF3BF","#FF922B"],st:30,sm:1.15,gl:14,mirror:true},
  {id:"stealth",n:"STEALTH",s:"Guide lines disappear",from:38,to:45,bg1:"#0A0A1A",bg2:"#0F0F2A",c:["#5C7CFA","#748FFC","#91A7FF","#BAC8FF","#DBE4FF","#339AF0"],st:40,sm:1.12,gl:8,noGuide:true},
  {id:"hyper",n:"HYPERDRIVE",s:"Maximum velocity",from:46,to:55,bg1:"#0A000A",bg2:"#1A0020",c:["#FF6B6B","#F06595","#E599F7","#B197FC","#845EF7","#FFC53D"],st:55,sm:1.35,gl:20},
  {id:"chaos",n:"CHAOS",s:"Random speed + shrink + mirrors",from:56,to:69,bg1:"#1A0A00",bg2:"#200A10",c:["#FF922B","#FD7E14","#F76707","#E8590C","#D9480F","#FFC53D"],st:70,sm:1.2,gl:16,chaos:true},
  {id:"zen",n:"ZEN ZONE",s:"Calm before the cosmos",from:70,to:84,bg1:"#050510",bg2:"#0A0A20",c:["#C3FAE8","#96F2D7","#63E6BE","#38D9A9","#20C997","#12B886"],st:90,sm:0.95,gl:22},
  {id:"cosmos",n:"COSMOS",s:"Beyond everything",from:85,to:9999,bg1:"#000000",bg2:"#050005",c:["#FFFFFF","#FFC53D","#FF6B6B","#00F5FF","#51CF66","#E599F7"],st:130,sm:1.45,gl:28},
];
function gP(sc){return PH.find(p=>sc>=p.from&&sc<=p.to)||PH[0]}
const PUS=[
  {id:"wide",l:"‚¨õ WIDER",c:"#51CF66",bg:"rgba(81,207,102,0.1)",bd:"rgba(81,207,102,0.2)",d:"Next block is wider"},
  {id:"slow",l:"üê¢ SLOW-MO",c:"#339AF0",bg:"rgba(51,154,240,0.1)",bd:"rgba(51,154,240,0.2)",d:"Half speed"},
  {id:"magnet",l:"üß≤ MAGNET",c:"#E599F7",bg:"rgba(229,153,247,0.1)",bd:"rgba(229,153,247,0.2)",d:"Auto-snap"},
  {id:"shield",l:"üõ°Ô∏è SHIELD",c:"#FFC53D",bg:"rgba(255,197,61,0.1)",bd:"rgba(255,197,61,0.2)",d:"Saves one miss"},
  {id:"freeze",l:"‚ùÑÔ∏è FREEZE",c:"#22B8CF",bg:"rgba(34,184,207,0.1)",bd:"rgba(34,184,207,0.2)",d:"Block stops 1s"},
];
const ACHS=[
  {id:"f",i:"üéØ",n:"First Stack",d:"Complete a game",ck:d=>d.gp>=1},
  {id:"10",i:"üîü",n:"Double Digits",d:"Score 10",ck:d=>d.bs>=10},
  {id:"25",i:"üåü",n:"Quarter Century",d:"Score 25",ck:d=>d.bs>=25},
  {id:"50",i:"üî•",n:"Fifty Stack",d:"Score 50",ck:d=>d.bs>=50},
  {id:"85",i:"üíé",n:"Cosmic Entry",d:"Score 85",ck:d=>d.bs>=85},
  {id:"100",i:"üëë",n:"Centurion",d:"Score 100",ck:d=>d.bs>=100},
  {id:"c3",i:"‚ö°",n:"Triple Threat",d:"3√ó combo",ck:d=>d.bc>=3},
  {id:"c5",i:"üåä",n:"On Fire",d:"5√ó combo",ck:d=>d.bc>=5},
  {id:"c10",i:"‚òÑÔ∏è",n:"Unstoppable",d:"10√ó combo",ck:d=>d.bc>=10},
  {id:"g10",i:"üéÆ",n:"Regular",d:"10 games",ck:d=>d.gp>=10},
  {id:"g50",i:"üèÖ",n:"Dedicated",d:"50 games",ck:d=>d.gp>=50},
  {id:"neo",i:"üíú",n:"Neon Runner",d:"Reach Neon Rush",ck:d=>d.bs>=8},
  {id:"hyp",i:"üöÄ",n:"Hyperdrive",d:"Reach Hyperdrive",ck:d=>d.bs>=46},
  {id:"zen",i:"üßò",n:"Inner Peace",d:"Reach Zen Zone",ck:d=>d.bs>=70},
  {id:"cos",i:"üåå",n:"Cosmic",d:"Reach the Cosmos",ck:d=>d.bs>=85},
];

// ‚ïê‚ïê‚ïê SAVE + DEVICE ID ‚ïê‚ïê‚ïê
const DEF={name:"Guest",bs:0,gp:0,tp:0,bc:0,ts:0,xp:0,ach:[],lang:"en",devId:""};
function ld(){try{const r=localStorage.getItem("stk5");if(r)return{...DEF,...JSON.parse(r)}}catch(e){}return{...DEF}}
function sv(d){try{localStorage.setItem("stk5",JSON.stringify(d))}catch(e){}}
let D=ld();
if(!D.devId){D.devId="d_"+Date.now()+"_"+Math.random().toString(36).slice(2,10);sv(D)}
function xpF(l){return l*l*50}
function gLv(x){let l=1;while(x>=xpF(l))l++;return l}
function gLvP(x){const l=gLv(x),p=xpF(l-1),n=xpF(l);return l===1?x/n:(x-p)/(n-p)}

// ‚ïê‚ïê‚ïê OFFLINE SCORE QUEUE ‚ïê‚ïê‚ïê
let offQ=[];
function ldQ(){try{const r=localStorage.getItem("stk5_q");if(r)offQ=JSON.parse(r)}catch(e){offQ=[]}}
function svQ(){try{localStorage.setItem("stk5_q",JSON.stringify(offQ))}catch(e){}}
ldQ();

let isOnline=navigator.onLine;
window.addEventListener("online",()=>{isOnline=true;updOD();syncQ()});
window.addEventListener("offline",()=>{isOnline=false;updOD()});
function updOD(){$("oD").className="online-dot "+(isOnline?"on":"off")}
updOD();

async function syncQ(){
  if(!isOnline||offQ.length===0)return;
  try{
    const r=await fetch("/api/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scores:offQ,deviceId:D.devId,playerName:D.name})});
    const d=await r.json();if(d.success){offQ=[];svQ();fetchLB()}
  }catch(e){}
}

async function submitScore(s){
  const data={score:s.sc,maxCombo:s.mc,perfects:s.pf,zone:gP(s.sc).n,xpEarned:s.sc*10+s.pf*5+s.mc*8,deviceId:D.devId,playerName:D.name};
  if(isOnline){
    try{await fetch("/api/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});fetchLB()}catch(e){offQ.push(data);svQ()}
  }else{offQ.push(data);svQ()}
}

let serverLB=[];
async function fetchLB(){
  if(!isOnline)return;
  try{const r=await fetch("/api/leaderboard");const d=await r.json();if(d.leaderboard)serverLB=d.leaderboard}catch(e){}
}
fetchLB();setInterval(fetchLB,30000);

async function checkName(n){
  if(!isOnline)return{available:true};
  try{const r=await fetch("/api/check-name?name="+encodeURIComponent(n)+"&deviceId="+D.devId);return await r.json()}catch(e){return{available:true}}
}

// ‚ïê‚ïê‚ïê CANVAS + AUDIO ‚ïê‚ïê‚ïê
const canvas=$("c"),ctx=canvas.getContext("2d");let W,H,dpr;
function resize(){dpr=window.devicePixelRatio||1;W=window.innerWidth;H=window.innerHeight;canvas.width=W*dpr;canvas.height=H*dpr;ctx.setTransform(dpr,0,0,dpr,0,0)}
window.addEventListener("resize",resize);resize();
let ac=null;
function iA(){if(!ac)ac=new(window.AudioContext||window.webkitAudioContext)();if(ac.state==="suspended")ac.resume()}
function tn(f,d,v){if(!ac)return;const o=ac.createOscillator(),g=ac.createGain();o.type="sine";o.frequency.value=f;g.gain.setValueAtTime(v||0.07,ac.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ac.currentTime+d);o.connect(g);g.connect(ac.destination);o.start();o.stop(ac.currentTime+d)}
function vb(p){if(navigator.vibrate)navigator.vibrate(p)}

let stars=[];function gSt(n){stars=[];for(let i=0;i<n;i++)stars.push({x:Math.random()*W,y:Math.random()*H,s:Math.random()*1.6+0.3,b:Math.random(),sp:Math.random()*0.004+0.001})}

// ‚ïê‚ïê‚ïê GAME ‚ïê‚ïê‚ïê
let S=null,run=false,aId=null,cPh="",tk=0;
function mkS(){return{stack:[{x:(W-BW)/2,w:BW,color:PH[0].c[0]}],mov:null,fall:[],pts:[],fire:[],trails:[],cam:0,sc:0,co:0,mc:0,pf:0,over:false,fl:0,shk:0,pu:null,puT:0,puN:Math.floor(Math.random()*5)+5,shield:false,frozen:0}}
function spn(s){const ph=gP(s.sc),top=s.stack[s.stack.length-1],ci=s.stack.length%ph.c.length;let spd=Math.min(SI+s.sc*SINC,SMAX)*ph.sm;if(ph.pulse)spd*=0.7+Math.sin(s.sc*0.3)*0.5;if(ph.chaos)spd*=0.8+Math.random()*0.6;const dir=s.sc%2===0?1:-1;let w=top.w;if(ph.shrink)w*=ph.shrink;if(ph.chaos&&Math.random()<0.3)w*=0.9+Math.random()*0.15;w=Math.max(w,top.w);if(s.pu==="wide")w=Math.min(w+26,BW*1.35);s.mov={x:dir===1?-w-20:W+20,w,dir,speed:spd,color:ph.c[ci],mCd:ph.mirror?Math.floor(Math.random()*30)+15:0}}

function startG(){iA();S=mkS();spn(S);run=true;cPh="";tk=0;gSt(0);$("hud").style.display="flex";["ovS","ovG","ovPr","ovGd","ovLn"].forEach(id=>$(id).classList.add("hide"));$("tap").style.display="block";$("dSc").textContent="0";$("dBs").textContent=D.bs;$("dCo").classList.remove("on");$("dFl").classList.remove("on");$("dPh").textContent="";$("dPu").classList.remove("on");uAv();if(!aId)loop()}
function goH(){run=false;S=null;if(aId){cancelAnimationFrame(aId);aId=null}$("hud").style.display="none";$("ovG").classList.add("hide");$("ovS").classList.remove("hide");$("tap").style.display="none";$("dPh").textContent="";$("dPu").classList.remove("on")}
function tap(){if(!S||S.over||!run)return;drop()}
function drop(){
  if(!S||S.over)return;const s=S;if(s.frozen>0)return;
  const top=s.stack[s.stack.length-1],m=s.mov,oS=Math.max(top.x,m.x),oE=Math.min(top.x+top.w,m.x+m.w);let oW=oE-oS;
  if(s.pu==="magnet"&&oW>0&&Math.abs(m.x-top.x)<22){s.stack.push({x:top.x,w:top.w,color:m.color});s.co++;s.pf++;if(s.co>s.mc)s.mc=s.co;s.fl=20;mP(s,top);vb(10);sF2(T("perfect"));aP(s,true);return}
  if(oW<=0&&s.shield){s.shield=false;$("dPu").classList.remove("on");s.stack.push({x:top.x,w:Math.max(top.w*0.55,18),color:m.color});s.co=0;s.sc++;sF2("SAVED!");$("dSc").textContent=s.sc;spn(s);return}
  if(oW<=0){s.over=true;s.fall.push({x:m.x,w:m.w,y:0,vy:0,rot:0,vr:(Math.random()-0.5)*0.08,color:m.color});tn(150,0.25,0.1);vb([50,30,50]);s.shk=10;eG(s);return}
  const perf=Math.abs(m.x-top.x)<PT&&Math.abs(m.w-top.w)<PT;
  if(perf){s.stack.push({x:top.x,w:top.w,color:m.color});s.co++;s.pf++;if(s.co>s.mc)s.mc=s.co;s.fl=20;mP(s,top);vb(10);sF2(s.co>=3?"üî• "+T("perfect"):T("perfect"))}
  else{s.stack.push({x:oS,w:oW,color:m.color});s.co=0;if(m.x<top.x)s.fall.push({x:m.x,w:top.x-m.x,y:0,vy:0,rot:0,vr:-0.03,color:m.color});if(m.x+m.w>top.x+top.w)s.fall.push({x:top.x+top.w,w:(m.x+m.w)-(top.x+top.w),y:0,vy:0,rot:0,vr:0.03,color:m.color});vb(5)}
  aP(s,perf);
}
function aP(s,perf){
  s.sc++;$("dSc").textContent=s.sc;tn(300+Math.min(s.co,12)*40,0.1,0.06);if(s.co>=2)tn(450+s.co*30,0.15,0.04);
  if(s.co>=2){$("dCo").classList.add("on");$("dCo").style.color=gP(s.sc).c[0];$("dCo").textContent="üî• √ó"+s.co+" "+T("perfect")}else $("dCo").classList.remove("on");
  if(s.co>=3){const t=s.stack[s.stack.length-1];for(let i=0;i<8;i++)s.fire.push({x:t.x+Math.random()*t.w,y:H-50-(s.stack.length-1)*BH+s.cam,life:1,vx:(Math.random()-0.5)*2.5,vy:-Math.random()*3.5-1.5,sz:Math.random()*5+3})}
  const ph=gP(s.sc);if(ph.id!==cPh){cPh=ph.id;$("dPh").textContent=ph.n;$("dPh").style.color=ph.c[0];gSt(ph.st);$("dPAN").textContent=ph.n;$("dPAN").style.textShadow="0 0 35px "+ph.c[0];$("dPAS").textContent=ph.s;$("dPA").classList.add("on");clearTimeout(aP._pa);aP._pa=setTimeout(()=>$("dPA").classList.remove("on"),1400);[523,659,784,1047].forEach((f,i)=>setTimeout(()=>tn(f,0.1,0.05),i*90))}
  if(ph.trail){const t=s.stack[s.stack.length-1];s.trails.push({x:t.x,w:t.w,y:H-50-(s.stack.length-1)*BH+s.cam,color:ph.c[s.stack.length%ph.c.length],life:1})}
  if(s.sc%10===0&&s.sc>0)sF2("‚Äî "+s.sc+" ‚Äî");
  if(s.sc>=s.puN&&!s.pu&&!s.shield){const pu=PUS[Math.floor(Math.random()*PUS.length)];if(pu.id==="shield"){s.shield=true;s.puN=s.sc+Math.floor(Math.random()*12)+10}else if(pu.id==="freeze"){s.frozen=60;s.puN=s.sc+Math.floor(Math.random()*10)+8}else{s.pu=pu.id;s.puT=pu.id==="slow"?8:pu.id==="magnet"?5:1;s.puN=s.sc+Math.floor(Math.random()*10)+7}$("dPu").textContent=pu.l;$("dPu").style.background=pu.bg;$("dPu").style.border="1px solid "+pu.bd;$("dPu").style.color=pu.c;$("dPu").classList.add("on");tn(800,0.07,0.04);setTimeout(()=>tn(1200,0.08,0.05),80)}
  if(s.pu){s.puT--;if(s.puT<=0){s.pu=null;$("dPu").classList.remove("on")}}
  spn(s);if(perf&&s.co>=2)s.mov.w=Math.min(s.stack[s.stack.length-1].w+s.co*1.2,BW*1.3);
}
function mP(s,t){for(let i=0;i<14;i++)s.pts.push({x:t.x+t.w/2+(Math.random()-0.5)*t.w*0.8,y:H-50-(s.stack.length-1)*BH+s.cam,vx:(Math.random()-0.5)*6,vy:-Math.random()*5-2,life:1,color:s.mov?s.mov.color:"#fff",sz:Math.random()*3.5+1.5})}
function sF2(t){$("dFl").textContent=t;$("dFl").classList.add("on");clearTimeout(sF2._t);sF2._t=setTimeout(()=>$("dFl").classList.remove("on"),320)}

function eG(s){
  const xp=s.sc*10+s.pf*5+s.mc*8,nw=s.sc>D.bs;
  D.gp++;D.ts+=s.sc;D.tp+=s.pf;D.xp+=xp;if(s.sc>D.bs)D.bs=s.sc;if(s.mc>D.bc)D.bc=s.mc;
  const nA=[];ACHS.forEach(a=>{if(!D.ach.includes(a.id)&&a.ck(D)){D.ach.push(a.id);nA.push(a)}});sv(D);
  $("gSc").textContent=s.sc;$("gBs").textContent=T("best")+": "+D.bs;$("gCo").textContent=s.mc;$("gPf").textContent=s.pf;$("gGp").textContent=D.gp;$("gXp").innerHTML="+<span>"+xp+"</span> XP";$("dBs").textContent=D.bs;$("gPh").textContent=T("reached")+": "+gP(s.sc).n;
  if(nw&&s.sc>0)$("gNw").classList.remove("hide");else $("gNw").classList.add("hide");
  $("dCo").classList.remove("on");$("dPu").classList.remove("on");$("tap").style.display="none";
  submitScore(s);
  setTimeout(()=>$("ovG").classList.remove("hide"),400);
  nA.forEach((a,i)=>setTimeout(()=>{$("dAcI").textContent=a.i;$("dAcN").textContent=a.n;$("dAc").classList.add("on");clearTimeout(eG._ac);eG._ac=setTimeout(()=>$("dAc").classList.remove("on"),2300);tn(523,0.06,0.04);setTimeout(()=>tn(784,0.1,0.05),120)},600+i*2000));
}

// ‚ïê‚ïê‚ïê SCREENS ‚ïê‚ïê‚ïê
function oP(){$("ovPr").classList.remove("hide");["ovS","ovG","ovGd","ovLn"].forEach(id=>$(id).classList.add("hide"));$("tap").style.display="none";rP()}
function cP(){$("ovPr").classList.add("hide");if(run&&S&&!S.over){$("hud").style.display="flex";$("tap").style.display="block"}else $("ovS").classList.remove("hide")}
function oGd(){$("ovGd").classList.remove("hide");["ovS","ovPr","ovLn"].forEach(id=>$(id).classList.add("hide"));$("tap").style.display="none"}
function cGd(){$("ovGd").classList.add("hide");$("ovS").classList.remove("hide")}
function oLn(){$("ovLn").classList.remove("hide");["ovS","ovPr","ovGd"].forEach(id=>$(id).classList.add("hide"));$("tap").style.display="none"}
function cLn(){$("ovLn").classList.add("hide");$("ovS").classList.remove("hide")}

function rP(){
  const l=gLv(D.xp),p=gLvP(D.xp);
  $("pAv").textContent=D.name==="Guest"?"?":D.name[0].toUpperCase();$("pNm").textContent=D.name;$("pLv").textContent="Level "+l;$("pXp").style.width=Math.round(p*100)+"%";$("pNI").value=D.name==="Guest"?"":D.name;
  $("s1").textContent=D.bs;$("s2").textContent=D.gp;$("s3").textContent=D.tp;$("s4").textContent=D.bc;$("s5").textContent=D.gp?Math.round(D.ts/D.gp):0;$("s6").textContent=D.xp;
  $("aG").innerHTML="";ACHS.forEach(a=>{const u=D.ach.includes(a.id);$("aG").innerHTML+=`<div class="ar ${u?"":"lk"}"><div style="font-size:16px;flex-shrink:0">${a.i}</div><div style="flex:1"><div style="color:#fff;font-size:10px;font-weight:bold">${a.n}</div><div style="color:rgba(255,255,255,0.2);font-size:8px;margin-top:1px">${a.d}</div></div>${u?'<div style="color:#51CF66;font-size:12px">‚úì</div>':""}</div>`});
  // Leaderboard ‚Äî real from server
  const ll=$("lL");ll.innerHTML="";
  if(serverLB.length>0){
    serverLB.forEach((p,i)=>{const r=i+1,rc=r===1?"color:#FFC53D":r===2?"color:#C0C0C0":r===3?"color:#CD7F32":"color:rgba(255,255,255,0.2)";const isYou=p.name===D.name;
      ll.innerHTML+=`<div class="lr ${isYou?"you":""}"><div style="font-size:12px;font-weight:bold;width:20px;text-align:center;${rc}">${r}</div><div style="flex:1;color:${isYou?"#FF6B6B":"rgba(255,255,255,0.5)"};font-size:11px">${p.name}${isYou?" (You)":""}</div><div style="color:rgba(255,255,255,0.35);font-size:12px;font-weight:bold">${p.score}</div></div>`});
  }else ll.innerHTML='<div style="color:rgba(255,255,255,0.15);font-size:10px;text-align:center;padding:12px">'+T("comingSoon")+'</div>';
  $("lbSync").textContent=offQ.length>0?offQ.length+" scores waiting to sync":"";
}
function uAv(){$("bPr").textContent=D.name==="Guest"?"?":D.name[0].toUpperCase()}

function buildGuide(){
  let h="";PH.forEach((p,i)=>{h+=`<div class="gd-c"><div class="gd-n" style="color:${p.c[0]}">${i+1}</div><div style="flex:1"><div class="gd-nm" style="color:${p.c[0]}">${p.n}</div><div class="gd-r">${T("score")} ${p.from}${p.to<9999?" ‚Äì "+p.to:"+"}</div><div class="gd-d">${p.s}</div><div class="gd-m" style="background:${p.c[0]}22;color:${p.c[0]}">${p.s.toUpperCase()}</div></div></div>`});$("gdL").innerHTML=h;
  let pu="";PUS.forEach(p=>{pu+=`<div style="display:flex;align-items:center;gap:9px;padding:8px 12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);border-radius:8px;margin-bottom:6px"><div style="font-size:18px">${p.l.split(" ")[0]}</div><div><div style="color:${p.c};font-size:10px;font-weight:bold">${p.l}</div><div style="color:rgba(255,255,255,0.25);font-size:8px;margin-top:1px">${p.d}</div></div></div>`});$("gdP").innerHTML=pu;
  $("gdTips").innerHTML=T("perfect")+" ‚Üí block grows back<br>High combos ‚Üí fire trails<br>üõ°Ô∏è Shield saves one miss<br>Red glow ‚Üí danger zone<br>Every 10 ‚Üí milestone";
}

function bldLangGrid(){
  const g=$("lnG");g.innerHTML="";
  Object.keys(LANGS).forEach(k=>{const l=LANGS[k];const d=document.createElement("div");d.className="lang-opt"+(k===CL?" sel":"");d.textContent=l.name;d.addEventListener("click",()=>{setLang(k);cLn()});g.appendChild(d)});
}

function shareG(){const u=window.location.href,t="üèóÔ∏è STACK ‚Äî How high can you stack? 10 phases, power-ups, leaderboard.\n\nPlay: "+u+"\n\nby bbmw0";if(navigator.share)navigator.share({title:"STACK ‚Äî by bbmw0",text:t,url:u}).catch(()=>{});else navigator.clipboard.writeText(t).then(()=>alert("Link copied!")).catch(()=>{})}
function shareS(){const sc=S?S.sc:0,ph=S?gP(S.sc).n:"",u=window.location.href,t="üèóÔ∏è STACK ‚Äî I scored "+sc+"! Reached "+ph+"\nBest: "+D.bs+" | Level "+gLv(D.xp)+"\n\nPlay: "+u;if(navigator.share)navigator.share({title:"STACK: "+sc,text:t,url:u}).catch(()=>{});else navigator.clipboard.writeText(t).then(()=>alert("Copied!")).catch(()=>{})}

// ‚ïê‚ïê‚ïê DRAW ‚ïê‚ïê‚ïê
function rr(c,x,y,w,h,r){c.beginPath();c.moveTo(x+r,y);c.lineTo(x+w-r,y);c.quadraticCurveTo(x+w,y,x+w,y+r);c.lineTo(x+w,y+h-r);c.quadraticCurveTo(x+w,y+h,x+w-r,y+h);c.lineTo(x+r,y+h);c.quadraticCurveTo(x,y+h,x,y+h-r);c.lineTo(x,y+r);c.quadraticCurveTo(x,y,x+r,y);c.closePath()}
function loop(){
  if(!S){aId=null;return}const s=S;tk++;
  if(!s.over&&s.mov){if(s.frozen>0){s.frozen--;if(s.frozen<=0)$("dPu").classList.remove("on")}else{let sp=s.mov.speed;if(s.pu==="slow")sp*=0.4;s.mov.x+=s.mov.dir*sp;if(s.mov.x+s.mov.w>W+30)s.mov.dir=-1;if(s.mov.x<-30)s.mov.dir=1;if(s.mov.mCd>0){s.mov.mCd--;if(s.mov.mCd<=0&&gP(s.sc).mirror){s.mov.dir*=-1;s.mov.mCd=Math.floor(Math.random()*25)+12}}}}
  const tc=Math.max(0,(s.stack.length-Math.floor(H/BH*0.55))*BH);s.cam+=(tc-s.cam)*0.06;
  s.fall=s.fall.filter(f=>{f.vy+=GR;f.y+=f.vy;f.rot+=(f.vr||0);return f.y<H+200});
  s.pts=s.pts.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.12;p.life-=0.02;return p.life>0});
  s.fire=s.fire.filter(f=>{f.x+=f.vx;f.y+=f.vy;f.life-=0.025;return f.life>0});
  s.trails=s.trails.filter(t=>{t.life-=0.013;return t.life>0});
  if(s.fl>0)s.fl--;if(s.shk>0)s.shk*=0.8;stars.forEach(st=>{st.b+=st.sp;if(st.b>1)st.b=0});
  const ph=gP(s.sc);ctx.save();
  if(s.shk>0.5)ctx.translate((Math.random()-0.5)*s.shk,(Math.random()-0.5)*s.shk*0.4);
  ctx.clearRect(-10,-10,W+20,H+20);const bg=ctx.createLinearGradient(0,0,0,H);bg.addColorStop(0,ph.bg1);bg.addColorStop(1,ph.bg2);ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);
  for(const st of stars){ctx.fillStyle=`rgba(255,255,255,${0.2+Math.sin(st.b*Math.PI*2)*0.3})`;ctx.beginPath();ctx.arc(st.x,st.y,st.s,0,Math.PI*2);ctx.fill()}
  const ga=Math.max(0.006,0.02-s.sc*0.0002);ctx.strokeStyle=`rgba(255,255,255,${ga})`;ctx.lineWidth=1;for(let gx=0;gx<W;gx+=30){ctx.beginPath();ctx.moveTo(gx,0);ctx.lineTo(gx,H);ctx.stroke()}
  const bY=H-50;
  for(const t of s.trails){ctx.save();ctx.globalAlpha=t.life*0.25;ctx.fillStyle=t.color;ctx.shadowColor=t.color;ctx.shadowBlur=16;ctx.fillRect(t.x,t.y,t.w,BH-2);ctx.restore()}
  for(let i=0;i<s.stack.length;i++){const b=s.stack[i],y=bY-i*BH+s.cam;if(y>H+BH||y<-BH*2)continue;ctx.fillStyle=b.color;ctx.shadowColor=b.color;ctx.shadowBlur=ph.gl;rr(ctx,b.x,y,b.w,BH-2,3);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="rgba(255,255,255,0.09)";ctx.fillRect(b.x,y,b.w,BH*0.25);if(i===s.stack.length-1&&b.w<BW*0.26&&!s.over){ctx.shadowColor="#FF0000";ctx.shadowBlur=18+Math.sin(tk*0.15)*6;ctx.strokeStyle="rgba(255,50,50,0.2)";ctx.lineWidth=2;rr(ctx,b.x,y,b.w,BH-2,3);ctx.stroke();ctx.shadowBlur=0}}
  if(s.shield&&s.stack.length>0){const top=s.stack[s.stack.length-1],ty=bY-(s.stack.length-1)*BH+s.cam;ctx.strokeStyle="rgba(255,197,61,"+(0.25+Math.sin(tk*0.07)*0.12)+")";ctx.lineWidth=2;ctx.setLineDash([4,4]);rr(ctx,top.x-3,ty-3,top.w+6,BH+4,5);ctx.stroke();ctx.setLineDash([])}
  if(!s.over&&s.mov){const my=bY-s.stack.length*BH+s.cam,m=s.mov;ctx.fillStyle=m.color;ctx.shadowColor=s.pu==="slow"?"#339AF0":s.pu==="magnet"?"#E599F7":m.color;ctx.shadowBlur=ph.gl+4;rr(ctx,m.x,my,m.w,BH-2,3);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="rgba(255,255,255,0.13)";ctx.fillRect(m.x,my,m.w,BH*0.25);if(!ph.noGuide){const top=s.stack[s.stack.length-1];ctx.setLineDash([3,4]);ctx.strokeStyle="rgba(255,255,255,0.05)";ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(top.x,my-10);ctx.lineTo(top.x,my+BH+6);ctx.stroke();ctx.beginPath();ctx.moveTo(top.x+top.w,my-10);ctx.lineTo(top.x+top.w,my+BH+6);ctx.stroke();ctx.setLineDash([])}}
  for(const f of s.fall){const fy=bY-s.stack.length*BH+s.cam+f.y;ctx.save();ctx.globalAlpha=Math.max(0,1-f.y/300);ctx.translate(f.x+f.w/2,fy+BH/2);ctx.rotate(f.rot||0);ctx.fillStyle=f.color;ctx.fillRect(-f.w/2,-BH/2+1,f.w,BH-2);ctx.restore()}
  for(const p of s.pts){ctx.save();ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.shadowColor=p.color;ctx.shadowBlur=4;ctx.beginPath();ctx.arc(p.x,p.y,p.sz*p.life,0,Math.PI*2);ctx.fill();ctx.restore()}
  for(const f of s.fire){ctx.save();ctx.globalAlpha=f.life*0.6;const gr=ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,f.sz*f.life);gr.addColorStop(0,"#FFC53D");gr.addColorStop(0.6,"#FF6B6B");gr.addColorStop(1,"transparent");ctx.fillStyle=gr;ctx.beginPath();ctx.arc(f.x,f.y,f.sz*f.life,0,Math.PI*2);ctx.fill();ctx.restore()}
  if(s.fl>0){ctx.save();ctx.globalAlpha=(s.fl/20)*0.08;ctx.fillStyle="#fff";ctx.fillRect(0,0,W,H);ctx.restore()}
  ctx.restore();aId=requestAnimationFrame(loop);
}

// ‚ïê‚ïê‚ïê EVENTS ‚ïê‚ïê‚ïê
$("tap").addEventListener("touchstart",e=>{e.preventDefault();tap()},{passive:false});
$("tap").addEventListener("mousedown",e=>{e.preventDefault();tap()});
$("ovS").addEventListener("touchstart",e=>{if(e.target.tagName==="BUTTON"||e.target.closest("button"))return;e.preventDefault();startG()},{passive:false});
$("ovS").addEventListener("mousedown",e=>{if(e.target.tagName==="BUTTON"||e.target.closest("button"))return;e.preventDefault();startG()});
$("startC").addEventListener("touchstart",e=>{e.preventDefault();e.stopPropagation();startG()},{passive:false});
$("startC").addEventListener("click",e=>{e.stopPropagation();startG()});
document.addEventListener("keydown",e=>{if(e.code!=="Space")return;e.preventDefault();if(!$("ovS").classList.contains("hide"))startG();else if(run&&S&&!S.over)tap()});
function btn(id,fn){$(id).addEventListener("click",e=>{e.stopPropagation();fn()});$(id).addEventListener("touchstart",e=>{e.preventDefault();e.stopPropagation();fn()},{passive:false})}
btn("bRe",startG);btn("bHo",goH);btn("bSS",shareS);btn("bSL",shareG);btn("bNP",oP);btn("bNG",oGd);btn("bPr",oP);btn("bPrX",cP);btn("bGdX",cGd);btn("bLng",oLn);btn("bLnX",cLn);
btn("pShr",shareG);btn("pGd",()=>{$("ovPr").classList.add("hide");oGd()});btn("pCof",()=>{window.location.href="https://buymeacoffee.com/bbmw0"});btn("pLng",()=>{$("ovPr").classList.add("hide");oLn()});
btn("pSync",()=>{syncQ();fetchLB();setTimeout(rP,1000)});
btn("bCof",()=>{window.location.href="https://buymeacoffee.com/bbmw0"});
btn("bNS",async()=>{const v=$("pNI").value.trim();if(!v||v.length<2){$("nmSt").textContent="Min 2 characters";return}const r=await checkName(v);if(!r.available){$("nmSt").textContent=T("nameTaken");$("nmSt").style.color="#FF6B6B";return}D.name=v;sv(D);rP();uAv();$("nmSt").textContent=T("nameOk");$("nmSt").style.color="#51CF66"});
["bG","bA","bL"].forEach(id=>btn(id,()=>alert(T("comingSoon")+" ‚Äî in development")));
btn("bRst",()=>{if(confirm("Reset?")){D={...DEF,devId:D.devId,lang:D.lang};sv(D);rP();uAv()}});
btn("iBanX",()=>{$("iBan").classList.remove("on");localStorage.setItem("stk5_ib","1")});
document.addEventListener("dblclick",e=>e.preventDefault());

// Install banner
setTimeout(()=>{if(!window.matchMedia("(display-mode:standalone)").matches&&!localStorage.getItem("stk5_ib"))$("iBan").classList.add("on")},3000);

// Init
if(D.lang&&LANGS[D.lang])setLang(D.lang);else setLang("en");
buildGuide();bldLangGrid();uAv();$("dBs").textContent=D.bs;syncQ();
})();
</script>
</body>
</html>
